import React,{useEffect,useMemo,useState}from'react';import{createRoot}from'react-dom/client';import'./index.css';
const DATA_URL=(import.meta.env.BASE_URL||'/')+'data/latest.json';
function Tag({children}){return <span className='px-2 py-0.5 text-xs rounded-full bg-gray-200'>{children}</span>;}
function Header(){return (<header className='py-6'><h1 className='text-2xl font-bold'>Health‑HCI PhD Agent</h1><p className='text-sm text-gray-600'>Daily updated <b>Health‑HCI & Information Design</b> PhD opportunities — <b>ETH / Melbourne / EU</b> focus<br/>每日更新的健康HCI与信息传达设计相关博士机会（优先：ETH / 墨尔本 / 欧洲）</p></header>);}
function useLocalProfile(){const KEY='profile_keywords';const [list,setList]=useState(()=>{try{return JSON.parse(localStorage.getItem(KEY))||['information design','health communication','AI chatbot','patient engagement'];}catch{return ['information design','health communication','AI chatbot','patient engagement'];}});useEffect(()=>{localStorage.setItem(KEY,JSON.stringify(list));},[list]);return [list,setList];}
function Filters({params,setParams}){return (<div className='flex gap-3 flex-wrap items-end bg-white rounded-2xl shadow p-4'><div><label className='text-xs text-gray-500'>Region 地区</label><select className='block border rounded px-3 py-2' value={params.region} onChange={e=>setParams(p=>({...p,region:e.target.value}))}><option value=''>All 全部</option><option>Switzerland</option><option>Australia</option><option>UK</option><option>Europe</option><option>Netherlands</option><option>Sweden</option><option>Finland</option><option>Denmark</option><option>Ireland</option></select></div><div><label className='text-xs text-gray-500'>Min Score 最低分</label><input className='border rounded px-3 py-2 w-28' type='number' value={params.minScore} onChange={e=>setParams(p=>({...p,minScore:e.target.value}))}/></div><div><label className='text-xs text-gray-500'>Funding 资助</label><select className='block border rounded px-3 py-2' value={params.hasFunding} onChange={e=>setParams(p=>({...p,hasFunding:e.target.value}))}><option value=''>All 全部</option><option value='1'>Has funding 有资助</option><option value='0'>No funding 无明确资助</option></select></div><button className='px-4 py-2 rounded-xl bg-black text-white' onClick={()=>setParams(p=>({...p}))}>Apply 应用</button></div>);}
function ProfileEditor({list,setList}){const[val,setVal]=useState('');const remove=idx=>setList(list.filter((_,i)=>i!==idx));const add=()=>{if(!val.trim())return;setList([...list,val.trim()]);setVal('');};return (<div className='bg-white rounded-2xl shadow p-5 space-y-3'><div className='text-lg font-semibold'>Profile Keywords 画像关键词</div><div className='flex gap-2 flex-wrap'>{list.map((k,i)=>(<span key={i} className='px-2 py-1 rounded-full bg-indigo-100 text-indigo-700 text-sm'>{k} <button className='ml-2 text-indigo-700' onClick={()=>remove(i)}>×</button></span>))}</div><div className='flex gap-2'><input className='border rounded px-3 py-2 flex-1' placeholder='Add / 添加…' value={val} onChange={e=>setVal(e.target.value)}/><button className='px-4 py-2 rounded-xl bg-indigo-600 text-white' onClick={add}>Add</button></div><div className='text-xs text-gray-500'>示例：information design, health communication, AI chatbot, patient engagement…（仅保存在本地浏览器）</div></div>);}
function Card({item,profile}){const hasHit=(item.profile_hits||'').toLowerCase().split(',').some(k=>profile.some(p=>k.trim().includes(p.toLowerCase())));return (<div className={'bg-white rounded-2xl shadow p-5 space-y-2 hover:shadow-lg transition '+(hasHit?'ring-2 ring-indigo-300':'')}><div className='flex items-center justify-between'><h3 className='text-lg font-semibold'>{item.university||'Unknown University'}</h3><div className='text-sm text-gray-500'>{item.region}</div></div><div className='text-sm text-gray-700'><div><b>Funding:</b> {item.funding||'TBD'} | <b>Collab:</b> {item.collaboration||'TBD'}</div><div><b>Deadline:</b> {item.deadline||'Rolling'}</div><div className='text-xs text-gray-500 break-words'><a href={item.link} target='_blank' rel='noreferrer'>{item.link}</a></div></div><div className='flex items-center gap-2 flex-wrap'><Tag>Score: {item.match_score}</Tag>{(item.profile_hits||'').split(',').slice(0,4).map((k,i)=>(k.trim()?<Tag key={i}>{k.trim()}</Tag>:null))}</div>{item.match_reason&&<div className='text-sm text-emerald-700'>{item.match_reason}</div>}</div>);}
function App(){const[data,setData]=useState({items:[]});const[params,setParams]=useState({region:'',minScore:0,hasFunding:''});const[profile,setProfile]=useLocalProfile();useEffect(()=>{fetch(DATA_URL).then(r=>r.json()).then(setData).catch(()=>setData({items:[]}));},[]);const items=useMemo(()=>{let arr=[...(data.items||[])];if(params.region)arr=arr.filter(x=>x.region===params.region);if(params.hasFunding!=='')arr=arr.filter(x=>params.hasFunding==='1'?x.funding:(!x.funding));const ms=parseInt(params.minScore||0,10);if(ms>0)arr=arr.filter(x=>(x.match_score||0)>=ms);return arr;},[data,params]);return (<div className='max-w-6xl mx-auto p-6 space-y-6'><Header/><Filters params={params} setParams={setParams}/><div className='grid grid-cols-1 md:grid-cols-2 gap-4'><ProfileEditor list={profile} setList={setProfile}/><div className='bg-white rounded-2xl shadow p-5'><div className='text-sm text-gray-600'>更新时间 Updated: {data.generated_at||'—'} · 共 {data.count||(data.items?.length||0)} 条</div><div className='text-xs text-gray-500 mt-2'>数据源：ETH CDHI / FindAPhD / EURAXESS / jobs.ac.uk / SIGCHI（RSS镜像）。</div></div></div><section className='grid grid-cols-1 md:grid-cols-2 xl-grid-cols-3 gap-4'>{items.map((it,idx)=>(<Card key={idx} item={it} profile={profile}/>))}</section></div>);}createRoot(document.getElementById('root')).render(<App/>);